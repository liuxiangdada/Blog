## 什么是Babel

Babel是一个JavaScript编译器，它将用户编写的ES678910语法编译成当下环境（浏览器或其他平台）可执行的版本，在babel的支持下，我们可以使用最新的js语法，甚至是提案

## Babel现在的情况

babel发展至今，成为了众多库的依赖，已经是JavaScript开发的基础，接下来我们了解一下babel6到babel7的发展情况

### babel6

babel5我没有使用过，从babel6开始，babel开始注重模块化，抽离原来的内置库成独立的模块，让所有插件可选，
这意味着babel默认不会编译ES2015代码，为了简单化插件配置，引入了preset，最后还提升了性能

接下来我们一一介绍

babel转化js代码的过程可以简述为 解析 -> 转换 -> 生成

babel本身只干解析和生成两件事，转换功能被拆解到插件里，所以如果不安装任何插件，babel的输入输出是相同的

#### 插件

插件分为语法插件和转译插件：

  - 语法插件使得babel能够解析更多的语法（babel内部使用的解析类库为babylon，非自己开发）
  - 转译插件，将源码转化成老版本（ES5）的写法，是babel的本质需求
  
  语法插件的例子：以前我们是不允许在函数参数的末尾添加逗号的，如果源代码这样写，会得到babel的报错提示，如今js提案已经允许这种写法，这样我们就需要安装babel-plugin-syntax-trailing-function-commas语法插件

  转译插件的例子：将箭头函数转化成老的函数写法安装babel-plugin-transform-es2015-arrow-functions转译插件

所以我们在babel配置文件中，主要配置的就是插件

    // .babelrc
    module.exports = {
      presets: [
        // 插件集合
      ],
      plugins: [
        // 插件
      ]
    }

#### preset

上面的配置文件中提到了presets选项，该选项存在的意义主要是节省开发者安装插件的时间，比如ES6的新特性包含了几十个插件，大部分情况我们不需要定制某些特性，而是希望使用所有的新特性，因此，我们需要所有的这些插件，因此根据需求和实际情况，提供了多种多样的插件集合，我们称为preset

preset分为官方的和stage-X两类

- 官方的preset有env、react、flow等
- stage-X里面包含的都是最新草案的插件列表，每年更新，一共有0~3，低级的版本会包含高级的版本，第四版会在下一年加入官方的env中，所以没有单独的版本

#### 执行顺序

默认插件选项的执行是最早的，它会依照着在plugins选项中的顺序依次执行

presets的执行顺序位于plugins之后，且它是倒序执行的，这是为了保证向后兼容，意思是如果你在最开始就把代码转译成ES5的代码，那么后面转译更新的语法时就会出现找不着该语法的情况从而报错

其实我们只要遵守在编排preset时**按照规范制定的时间列出即可**

#### 配置项

简略情况，presets和plugins都只需要列出字符串名称即可，但是如果某个preset或者插件需要进行配置的话，则需要使其变成数组格式

    [
      'env',
      {
        module: false
      }
    ]

#### env

env出现的目的就是减少用户判断使用环境选择preset的成本，它能够根据项目的配置得知运行环境的特点，只做必要的转换，比如如果浏览器支持ES6，那么就不需要es2015这个preset，减少构建时间

如果不加配置项，env等价于lastest，也就是 es2015 + es2016 + es2017三者相加

    presets: [
      [
        'env',
        {
          targets: {
            browsers: ['last 2 versions', 'safari >= 7']
          }
        }
      ]
    ]

这个配置的意思是只考虑所有浏览器的最新的两个版本以及Safari大于7.0的版本的特性，如果这些浏览器已经支持，就不转译

对于node环境可以这样配置，表示支持最新的稳定版本

    presets: [
      [
        'env',
        {
          targets: {
            node: 'current'
          }
        }
      ]
    ]

#### 配套工具



## Babel的工作原理

## 自己写一个Babel插件